<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">
<link rel="import" href="../d2l-table/d2l-table.html">
<link rel="import" href="../d2l-checkbox/d2l-checkbox.html">
<link rel="import" href="../d2l-button/d2l-button.html">
<link rel="import" href="../d2l-offscreen/d2l-offscreen.html">
<link rel="import" href="../d2l-ajax/d2l-ajax.html">


<!--
`activity-exemptions`
Activity exemptions

@demo demo/index.html
-->

<dom-module id="activity-exemptions">
	<template>
		<style>
			:host {
				display: block;
			}
			d2l-button {
				margin: 10px;
			}
		</style>

		<iron-ajax
		id="getClasslist"
    url="https://qa10768178g.bspc.com/d2l/api/le/1.12/123780/classlist/"
		headers='{ "Authorization": "Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImtpZCI6ImJjMWFmOGRhLTNmOWYtNDIyNC1hMTBkLTE4ZmU4NzM0YTk1YSJ9.eyJzdWIiOiIxNjkiLCJ0ZW5hbnRpZCI6IjU0MmUwYjRjLWM4M2MtNDA3OS1iZWYxLTc1ZjU4ZjdmZmVlZSIsInNjb3BlIjoiKjoqOioiLCJqdGkiOiI0ODlhNDE5My0yMjYyLTQ2ODEtYTcxZS00Mzg5ODRjYWEyMTgiLCJpc3MiOiJodHRwczovL2FwaS5icmlnaHRzcGFjZS5jb20vYXV0aCIsImF1ZCI6Imh0dHBzOi8vYXBpLmJyaWdodHNwYWNlLmNvbS9hdXRoL3Rva2VuIiwiZXhwIjoxNTAzNDM1OTMyLCJuYmYiOjE1MDM0MzIzMzJ9.Xl8ZJnhAlkS3sTEmQL7Qo1NfQTdyTNMaEQAK0tHl04A884c_LYwz9fZ-m8kvWQ7_pQPEWI7i-mSN74-HrcwJRF1-mIcD9zs8UzxuEZh4S0RtdF8wxNdSRPg6uUozzp9TE2k2jubcazTKBlGd_DVJ3j0ldfHkdIQn-58T9U2kRfW-r0itK26CPQRI_fIJleOkPlbL_eFygotKRvSaaHZGL1O8p4p6t7iccIeHFuac2423na4ippBuwikVDFCaFrYwTmwL0dQc9PfLHGVuwQbQq3S-861pq-JVYcMNO6InlazgLkQR2v0kIw1185I7fvKEw6wzser4qkde8fybOuIJPQ"}'
    handle-as="json"
    on-response="handleClasslistResponse"
		method="GET"
    ></iron-ajax>

		<iron-ajax
		id="getExemptions"
    url="http://demo5254249.mockable.io/getExemptions"
		headers='{ "Authorization": "Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImtpZCI6ImZiNTExYTU2LTk4MzctNDY5My05NTRiLTcxNjkwODI1NWY1OCJ9.eyJzdWIiOiIxNjkiLCJ0ZW5hbnRpZCI6IjU0MmUwYjRjLWM4M2MtNDA3OS1iZWYxLTc1ZjU4ZjdmZmVlZSIsInNjb3BlIjoiKjoqOioiLCJqdGkiOiI3NzQyODRjYi04YjEwLTQ4ODEtYmEyZC01YmVhZDUxMWY5OTAiLCJpc3MiOiJodHRwczovL2FwaS5icmlnaHRzcGFjZS5jb20vYXV0aCIsImF1ZCI6Imh0dHBzOi8vYXBpLmJyaWdodHNwYWNlLmNvbS9hdXRoL3Rva2VuIiwiZXhwIjoxNTAzNDMxNzI4LCJuYmYiOjE1MDM0MjgxMjh9.XnaB1nbm-tUqwYpZLMt1jSJbNRx0uWDWH1rmu_v0S53v8HoRieJpQpw59hKUaYu64D12fHwzPKD00aO6YtnaOLyJhWWXtp5lHo8oJDV_fUZKhfe8tEXOdQXRNV9V-_AnRILCogRG7OGBP6JvXiTZ5mhQi00nOsGOX_JbT5NhHaUPKC9eH0d9NS8J7GzNpgikQxkz4CNTWLhulPYRRfscH-SE9HSCqUJD4p0kx9RI__BrZL1i5jyVLnX9zSqqFR0qmSw4hCXsfh_9D8tNnryMM_tnDH9tI230v1UFYk0ydpofFVRTQ_ktQK-HFCnceUH6bxOLqtUiSC7uI4fvQMpfIg"}'
    handle-as="json"
    on-response="handleExemptionsResponse"
		method="GET"
    ></iron-ajax>

    <!-- <iron-ajax
      auto
      url="http://192.168.138.12:30610/grades"
      handle-as="json"
      on-response="handleResponse"
      id="loaddata">
    </iron-ajax> -->

    <div role="main">
      <d2l-button role="button" aria-label="Exempt Selected Users" primary>Exempt</d2l-button>
      <d2l-button  role="button" aria-label="Unexempt Selected Users">Unexempt</d2l-button>
      <table is="d2l-table" role="grid" summary="The list of users that can have their exemption status modified.">
        <caption><d2l-offscreen>Exempt from activity<d2l-offscreen></caption>
        <thead>
          <tr role="row">
            <th><d2l-checkbox aria-label="Select All Users" on-change="selectAll"></d2l-checkbox></th>
            <th scope="col" role="columnheader" aria-sort="none"><button is="d2l-table-col-sort-button" role="button" nosort>Last Name, First Name</button></th>
            <th scope="col" role="columnheader"><button is="d2l-table-col-sort-button" role="button" nosort>Exempt Status</button></th>
          </tr>
        </thead>
        <tbody>
          <template is="dom-repeat" items="[[classlist]]">
            <tr role="row">
              <td><d2l-checkbox class="checkbox-user" aria-label="Select [[item.LastName]], [[item.FirstName]]"></d2l-checkbox></td>
              <th scope="row" role="rowheader">[[item.LastName]], [[item.FirstName]]</th>
              <template is="dom-if" if="[[item.isExempt]]">
                <th scope="row" role="rowheader">Exempt</th>
              </template>
              <template is="dom-if" if="[[!item.isExempt]]">
                <th scope="row" role="rowheader"><d2l-offscreen>Not Exempt</d2l-offscreen></th>
              </template>
            </tr>
          </template>
        </tbody>
      </table>
      <d2l-button role="button" aria-label="Exempt Selected Users" primary>Exempt</d2l-button>
      <d2l-button role="button" aria-label="Unexempt Selected Users">Unexempt</d2l-button>
    </div>
  </template>

	<script>
		Polymer({

			is: 'activity-exemptions',

			properties: {
				classlist: {
					type: Object,
					value: []
				},
				exemptions: {
					type: Object,
					value: []
				}
			},

			ready: function(e) {
				this.$.getClasslist.generateRequest();
				this.$.getExemptions.generateRequest();

				
			},

			handleClasslistResponse: function(e) {
				console.log(e.detail.response)
				this.set( 'classlist', e.detail.response );
			},

			handleExemptionsResponse: function(e) {
				console.log(e.detail.response)
				this.set( 'exemptions', e.detail.response );
			},

			selectAll: function(e) {
				var checkboxes = Polymer.dom(this.root).querySelectorAll('.checkbox-user');
				if ( e.target.checked ) {
					checkboxes.forEach(function(element) {
						element.checked = true;
					});
				} else {
					checkboxes.forEach(function(element) {
						element.checked = false;
					});
				}
			}

		});
	</script>
</dom-module>
